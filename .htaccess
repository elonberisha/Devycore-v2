# ============================================
# Devycore V2 - Apache Configuration
# ============================================

# Enable mod_rewrite
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /devycore-v2/

    # Redirect to public directory
    RewriteCond %{REQUEST_URI} !^/devycore-v2/public/
    RewriteRule ^(.*)$ public/$1 [L]
</IfModule>

# ============================================
# Security Headers
# ============================================
<IfModule mod_headers.c>
    # Prevent clickjacking
    Header always set X-Frame-Options "DENY"

    # Prevent MIME type sniffing
    Header always set X-Content-Type-Options "nosniff"

    # Referrer policy
    Header always set Referrer-Policy "strict-origin-when-cross-origin"

    # Permissions policy
    Header always set Permissions-Policy "camera=(), microphone=(), geolocation=()"

    # XSS protection
    Header always set X-XSS-Protection "1; mode=block"

    # Content Security Policy (adjust for production)
    Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://unpkg.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com data:; img-src 'self' data: blob:; connect-src 'self'; object-src 'none'; base-uri 'self'; frame-ancestors 'none';"

    # HSTS (only enable when HTTPS is configured)
    # Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains" env=HTTPS
</IfModule>

# ============================================
# Protect Sensitive Files
# ============================================

# Block access to .env files
<FilesMatch "^\.env">
    Require all denied
</FilesMatch>

# Block access to composer files
<FilesMatch "^composer\.(json|lock)$">
    Require all denied
</FilesMatch>

# Block access to git files
<FilesMatch "^\.git">
    Require all denied
</FilesMatch>

# Block access to SQL files
<FilesMatch "\.sql$">
    Require all denied
</FilesMatch>

# Block access to log files
<FilesMatch "\.log$">
    Require all denied
</FilesMatch>

# Block access to vendor directory (if in web root)
RedirectMatch 404 ^/vendor/.*$

# Block access to src directory
RedirectMatch 404 ^/src/.*$

# Block access to database directory
RedirectMatch 404 ^/database/.*$

# ============================================
# Disable Directory Listing
# ============================================
Options -Indexes

# ============================================
# Cache Control
# ============================================
<IfModule mod_expires.c>
    ExpiresActive On

    # Images
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 month"
    ExpiresByType image/x-icon "access plus 1 year"

    # CSS and JavaScript
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType text/javascript "access plus 1 month"

    # Fonts
    ExpiresByType font/woff2 "access plus 1 year"
    ExpiresByType font/woff "access plus 1 year"
    ExpiresByType font/ttf "access plus 1 year"
    ExpiresByType font/otf "access plus 1 year"

    # HTML (short cache)
    ExpiresByType text/html "access plus 0 seconds"

    # JSON API responses (no cache)
    ExpiresByType application/json "access plus 0 seconds"
</IfModule>

# ============================================
# Compression (Gzip)
# ============================================
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE text/javascript
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/json
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE image/svg+xml
</IfModule>

# ============================================
# MIME Types
# ============================================
<IfModule mod_mime.c>
    AddType application/javascript js
    AddType text/css css
    AddType image/svg+xml svg svgz
    AddType font/woff2 woff2
    AddType font/woff woff
    AddEncoding gzip svgz
</IfModule>

# ============================================
# Character Encoding
# ============================================
AddDefaultCharset utf-8

# ============================================
# PHP Settings (if needed)
# ============================================
<IfModule mod_php.c>
    php_value upload_max_filesize 5M
    php_value post_max_size 6M
    php_value memory_limit 128M
    php_value max_execution_time 30
    php_flag display_errors Off
    php_flag log_errors On
</IfModule>

# ============================================
# Error Pages (optional)
# ============================================
# ErrorDocument 404 /public/404.html
# ErrorDocument 500 /public/500.html
